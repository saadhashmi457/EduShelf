{% extends 'base/base.html' %}
{% load static %}

{% comment %} {% block title %} User Dashboard {% endblock title %} {% endcomment %}

{% block content %}
<style>
    /* Modern Dashboard Styling */
    body {
        background: linear-gradient(135deg, #0f1115, #1f242d);
        color: #fff;
    }

    
    .navbar {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding: 0 32px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .navbar h1 { font-size: 1.5rem; font-weight: bold; }
    .navbar a { color: #f8fafc; text-decoration: none; font-weight: 500; transition: color 0.3s ease; }
    .navbar a:hover { color: red; }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #14b8a6;
        margin-bottom: 2.5rem;
        text-shadow: 1px 1px 4px rgba(0,0,0,0.5);
    }

    .dashboard-card {
        border-radius: 20px;
        border: none;
        background: linear-gradient(145deg, #1f242d, #2a2e38);
        transition: all 0.4s ease;
        padding: 1.5rem;
    }

    .dashboard-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.4);
    }

    .badge {
        font-size: 0.9rem;
        padding: 6px 14px;
        border-radius: 25px;
        font-weight: 500;
    }

    .status-pending {
        background-color: #fbbf24;
        color: #1f2937;
    }
    .status-approved {
        background-color: #22c55e;
        color: white;
    }
    .status-rejected {
        background-color: #ef4444;
        color: white;
    }

    /* Buttons */
    .btn {
        transition: all 0.3s ease;
    }
    .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    /* Card Titles */
    h4 {
        font-weight: 600;
        color: #14b8a6;
        margin-bottom: 1rem;
    }

    /* Book Card Image */
    .book-card-img {
        height: 200px;
        width: 40%;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }
    .book-card-img:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    }

    /* Text Muted */
    .text-muted {
        color: #b0b0b0;
    }

    /* Section Spacing */
    .section {
        margin-top: 4rem;
        margin-bottom: 4rem;
    }

</style>
<header class="navbar ">
    <h1>‚öôÔ∏è User Dashboard</h1>
    <nav><a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a></nav>
</header>
<div class="container mt-16 mx-auto animate-section">

    <!-- Dashboard Heading -->
      <div class="text-5xl font-extrabold tracking-tight mb-6 leading-tight text-center "> 
    <h2 classs="">üìä User<span class="text-amber-500 text-4xl">   Dashboard</span></h2>
     </div>
     <hr class="my-10 h-[2px] w-full border-0 bg-gradient-to-r from-amber-500 via-white to-amber-500 opacity-40 shadow-md transition-all duration-500 hover:opacity-80 hover:shadow-amber-500/50">
   

    <!-- User Info Section -->
    <div class="dashboard-card shadow p-6 mb-12 text-center text-lg ">
        <h4 class="text-2xl ">üë§ My Profile</h4>
        <p><strong>Name:</strong> {{ user.full_name }}</p>
        <p><strong>Email:</strong> {{ user.university_email }}</p>
        <p><strong>Department:</strong> {{ user.department }}</p>
        <p><strong>Role:</strong> 
            {% if user.is_staff %}
              <span class="badge bg-purple-600">Admin</span>
            {% else %}
              <span class="badge bg-blue-600">Student</span>
            {% endif %}
        </p>
    </div>


<!-- Notifications Section -->
<div class="dashboard-card shadow p-6 section text-lg min-h-[50vh]">
  <h4 class="text-center text-2xl">üîî Notifications</h4>

  {% if user.notifications.all %}
    <ul class="list-unstyled mt-4">
      {% for notif in user.notifications.all %}
        <li class="mb-3 p-3 rounded-lg {% if not notif.is_read %}bg-gray-800{% else %}bg-gray-700{% endif %}">
          <p>{{ notif.message }}</p>
          <small class="text-muted">{{ notif.created_at|date:"M d, Y H:i" }}</small>
          {% if not notif.is_read %}
            <a href="{% url 'mark_notification_read' notif.id %}" class="btn btn-sm btn-success ml-2">Mark as read</a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-center text-gray-400 italic">üì≠ No notifications yet.</p>
  {% endif %}
</div>



    <!-- My Requests Section -->
    <div class="dashboard-card shadow p-6 section text-lg min-h-[80vh]">
        <h4 class="text-center text-2xl">üì© My Requests</h4>

        {% if user.book_requests.all %}
          <div class="row">
            {% for request in user.book_requests.all %}
              <div class="col-md-6 mb-5">
                <div class="dashboard-card h-100 text-center p-4">
                    <h5 class="font-bold mb-2">{{ request.book.title }}</h5>
                    <p>Status: 
                      {% if request.status == "pending" %}
                        <span class="badge status-pending">‚è≥ Pending</span>
                      {% elif request.status == "approved" %}
                        <span class="badge status-approved">‚úÖ Approved</span>
                      {% else %}
                        <span class="badge status-rejected">‚ùå Rejected</span>
                      {% endif %}
                    </p>
                    <p class="text-muted text-sm mt-2">Requested on: {{ request.created_at|date:"M d, Y" }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-center text-gray-400 italic">üòî You haven‚Äôt requested any books yet.</p>
        {% endif %}
    </div>




    

    <!-- My Uploaded Books Section -->
    <div class="dashboard-card shadow p-8 section text-lg">
      <h4 class="text-center mb-6 text-2xl">üìö My Uploaded Books</h4>

      {% if uploaded_books %}
        <div class="row justify-content-center text-center my-12">
          {% for book in uploaded_books %}
            <div class="col-sm-6 col-md-4 col-lg-3 mb-5 d-flex justify-content-center">
              <div class="dashboard-card h-100 p-4 text-center" style="width: 100%;">
                {% if book.cover_image %}
                  <img src="{{ book.cover_image.url }}" class="book-card-img mx-auto d-block" alt="{{ book.title }}">
                {% else %}
                  <img src="{% static 'images/default-book.jpg' %}" class="book-card-img mx-auto d-block" alt="{{ book.title }}">
                {% endif %}

                <div class="card-body mt-3">
                  <h5 class="font-bold text-lg mb-2">{{ book.title }}</h5>
                  <p class="text-muted text-sm mb-3">{{ book.description|truncatewords:15 }}</p>
                  <p><span class="badge bg-indigo-600">Uploaded on {{ book.created_at|date:"M d, Y" }}</span></p>

                  <div class="mt-3">
                    <a href="{% url 'book_detail' book.id %}" class="btn btn-sm btn-primary mx-1">üîç View</a>
                    <a href="{% url 'edit_book' book.id %}" class="btn btn-sm btn-warning mx-1">‚úèÔ∏è Edit</a>
                    <a href="{% url 'delete_book' book.id %}" class="btn btn-sm btn-danger mx-1" onclick="return confirm('Are you sure you want to delete this book?')">üóëÔ∏è Delete</a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-center text-gray-400 italic">üì≠ You haven‚Äôt uploaded any books yet.</p>
      {% endif %}
    </div>

</div>
{% endblock %}
