{% extends "base/base.html" %}
{% load static %}

{% block title %}Chat{% endblock %}

{% block content %}
<style>
  body { background: radial-gradient(1200px 600px at 10% -10%, #0ea5e9 0%, transparent 40%), #0f172a; color:#e2e8f0; }
  .chat-wrap { max-width: 1000px; margin: 80px auto 40px; padding: 0 20px; }

  .chat-card {
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.12); border-radius:20px; overflow:hidden;
    box-shadow: 0 20px 50px rgba(0,0,0,.35);
  }

  .chat-head {
    display:flex; align-items:center; gap:14px; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.08);
    background: rgba(2,6,23,.6); backdrop-filter: blur(6px);
  }
  .head-avatar { height:42px; width:42px; border-radius:50%; background:#14b8a6; display:flex; align-items:center; justify-content:center; font-weight:800; color:white; }
  .head-title { font-size:1.1rem; font-weight:800; color:#f8fafc; }
  .head-sub { font-size:.85rem; color:#94a3b8; }

  .messages { height: 60vh; overflow-y:auto; padding:18px; background: rgba(2,6,23,.35); }
  .msg-line { margin-bottom:12px; display:flex; }
  .msg-me { justify-content:flex-end; }
  .bubble {
    max-width:70%; padding:10px 14px; border-radius:16px; line-height:1.35;
    box-shadow: 0 8px 20px rgba(0,0,0,.25);
  }
  .bubble-me { background:#4f46e5; color:white; border-top-right-radius:6px; }
  .bubble-other { background:#334155; color:#e2e8f0; border-top-left-radius:6px; }
  .msg-time { font-size:.75rem; color:#94a3b8; margin-top:4px; }
  .composer {
    display:flex; gap:10px; padding:14px; border-top:1px solid rgba(255,255,255,.08); background: rgba(2,6,23,.6);
  }
  .input {
    flex:1; background:#0b1220; color:#e2e8f0; border:1px solid rgba(255,255,255,.14);
    border-radius:12px; padding:12px 14px; outline:none; transition: box-shadow .2s ease, border .2s ease;
  }
  .input:focus { border-color:#14b8a6; box-shadow:0 0 0 4px rgba(20,184,166,.15); }
  .send {
    padding:12px 16px; background:#22c55e; color:white; border-radius:12px; font-weight:800;
    border:1px solid rgba(255,255,255,.14);
    transition: transform .2s ease, background .2s ease, box-shadow .2s ease;
  }
  .send:hover { transform: translateY(-1px); background:#16a34a; box-shadow: 0 10px 24px rgba(34,197,94,.35); }

  .back-link {
    margin-left:auto; color:#cbd5e1; font-weight:600; text-decoration:none; padding:8px 10px; border-radius:10px;
    transition: background .2s ease, transform .2s ease;
  }
  .back-link:hover { background: rgba(255,255,255,.08); transform: translateY(-1px); }
</style>

<div class="chat-wrap">
  <div class="chat-card">
    <div class="chat-head">
      <div class="head-avatar">{{ other_user.full_name|default:other_user.university_email|slice:":1"|upper }}</div>
      <div>
        <div class="head-title">{{ other_user.full_name|default:other_user.university_email }}</div>
        <div class="head-sub">{{ other_user.department|default:"" }} {% if other_user.department %}‚Ä¢{% endif %} {{ other_user.university_email }}</div>
      </div>
      <a href="{% url 'inbox' %}" class="back-link">‚Üê Inbox</a>
    </div>

    <div id="msgs" class="messages">
      {% for msg in messages %}
        <div class="msg-line {% if msg.sender == request.user %}msg-me{% endif %}">
          <div>
            <div class="bubble {% if msg.sender == request.user %}bubble-me{% else %}bubble-other{% endif %}">
              {{ msg.message }}
            </div>
            <div class="msg-time">{{ msg.timestamp|date:"M d, H:i" }}</div>
          </div>
        </div>
      {% empty %}
        <p class="head-sub" style="padding:6px 2px 12px 2px;">No messages yet. Say hi üëã</p>
      {% endfor %}
    </div>

    <form method="POST" class="composer">
      {% csrf_token %}
      <input class="input" type="text" name="message" placeholder="Type your message‚Ä¶" required />
      <button type="submit" class="send">Send</button>
    </form>
  </div>
</div>

<script>
  // auto-scroll to last message
  const box = document.getElementById('msgs');
  if (box) box.scrollTop = box.scrollHeight;
</script>
{% endblock %}
